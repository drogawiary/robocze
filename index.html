<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Nowenna rozwiÄ…zujÄ…ca wÄ™zÅ‚y â€” interaktywnie (9 dni)</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
  
<style>
  :root{
    --bg: #f3f6ff;
    --panel: #ffffff;
    --panel-2:#eef2ff;
    --text:#0e1533;
    --muted:#6370a0;
    --accent:#2450ff;
    --accent-2:#6ea8ff;
    --ring:#2450ff22;
    --ok:#2563eb;
    --ok-strong:#1d4ed8;
    --soft:#e8edff;
    --chip:#dbe5ff;
  }
  .dark{
    --bg:#0f1221;
    --panel:#161a2f;
    --panel-2:#1a1f3a;
    --text:#e8edff;
    --muted:#a7b1e6;
    --accent:#8ea0ff;
    --accent-2:#6ea8ff;
    --ring:#8ea0ff33;
    --ok:#8ea0ff;
    --ok-strong:#b2c2ff;
    --soft:#20254a;
    --chip:#272f63;
  }
/* ğŸŒ™ Jasny maryjny kolor i delikatna poÅ›wiata dla dni tygodnia (tryb nocny) */
.dark .content a[data-rosary] {
  color: #b9d5ff;              /* pastelowy maryjny bÅ‚Ä™kit */
  font-weight: 600;
  text-shadow: 0 0 6px #4f7fff; /* subtelny efekt poÅ›wiaty */
  transition: all 0.3s ease;
}

.dark .content a[data-rosary]:hover {
  color: #e3eeff;              /* jaÅ›niejszy przy najechaniu */
  text-shadow: 0 0 10px #a5c9ff, 0 0 20px #7fb3ff; /* efekt aurory */
  text-decoration: underline;
}

/* ğŸ’« PoÅ›wiata dla paska informacyjnego "tryb podglÄ…du" */
.dark .previewInfo {
  background: #101940;
  box-shadow: 0 0 14px #2e4aff80; /* delikatny bÅ‚Ä™kitny glow */
  border: 1px solid #3a55ff40;
  color: #ffffff;
  text-shadow: 0 0 8px #7fa7ff, 0 0 16px #4f7fff;
}

.previewInfo {
  background: #e8f0ff;
  box-shadow: 0 0 12px #bcd2ff;
  border: 1px solid #d0e0ff;
  color: #0e1533;
  font-weight: 700;
}

/* ğŸ’ PoÅ›wiata i pogrubienie dla tytuÅ‚Ã³w tajemnic rÃ³Å¼aÅ„ca w trybie nocnym */
.dark .content h4,
.dark .content strong {
  color: #dbe4ff;
  font-weight: 700;
  text-shadow: 0 0 8px #7fa7ff, 0 0 16px #4f7fff; /* maryjna poÅ›wiata */
}

/* W dzieÅ„ â€“ tylko mocniejszy kontrast, bez Å›wiecenia */
.content h4,
.content strong {
  color: #0e1533;
  font-weight: 700;
}

 /* âœï¸ Styl dopisku o wÄ™Åºle w nowennie */
.dark .wezel-info {
  color: #cdd9ff;
  text-shadow: 0 0 8px #7fa7ff, 0 0 16px #4f7fff; /* delikatny blask */
}

.wezel-info {
  color: #24336b;
  font-style: italic;
  margin-top: 6px;
}


   
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; background:var(--bg); color:var(--text); font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;}
.wrap{max-width:800px; margin:0 auto; padding:18px;}
  header{display:block; margin-bottom:14px}
.banner {
  background: linear-gradient(145deg, #0b3d91, #1565c0, #1e88e5);
  color: #fff;
  border-radius: 18px;
  padding: 18px;
  text-align: center;
  box-shadow: 0 8px 24px #0002;
  border: 1px solid #ffffff22;
  margin-bottom: 12px;
}

.banner h1 {
  margin: 0;
  font-size: clamp(22px, 4.5vw, 32px); /* rozmiar zostaje ten sam */
  font-weight: 800;
  letter-spacing: .2px;
  font-family: 'Playfair Display', serif;
  text-shadow: 0 0 8px #fff, 0 0 16px #a8c8ff;
  color: #fff;
}

  .menu{position:absolute; top:100%; margin-top:8px; background:var(--panel); border:1px solid #00000015; box-shadow:0 14px 40px #0003; border-radius:14px; padding:8px; min-width:220px; max-width:280px; z-index:50; display:none}
  .menu.show{display:block}
  .menu h4{margin:6px 8px 8px; font-size:12px; color:var(--muted); font-weight:700; letter-spacing:.2px}
  .menu .item{display:flex; align-items:center; justify-content:space-between; gap:8px; padding:8px 10px; border-radius:10px; cursor:pointer}
  .menu .item:hover{background:var(--soft)}
  .menu .item .meta{font-size:11px; color:var(--muted)}
  .menu .del{border:none; background:#f1f3ff; color:#1a2a7a; border-radius:8px; padding:6px 8px; cursor:pointer}
  .menu .empty{padding:10px; font-size:12px; color:var(--muted)}
  .controls{display:flex; gap:8px; align-items:center;}
  .field{display:flex; gap:8px; align-items:center; background:var(--panel); border:1px solid #00000010; padding:6px 8px; border-radius:12px}
  .field input{border:none; outline:none; background:transparent; color:var(--text); font-size:14px; padding:6px; width:130px}
  .btn{border:none; border-radius:12px; padding:10px 14px; cursor:pointer; font-weight:700; letter-spacing:.2px}
  .toggle{background:var(--panel); border:1px solid #00000010; box-shadow:0 4px 14px #0002;}
  .square{width:40px; height:40px; padding:0; display:grid; place-items:center; background:#e7ebff; color:#1a2a7a}
  .square.active{background:#1a2a7a; color:#e7ebff}
  .start{background:linear-gradient(180deg, #35b86b, #2ea45f); color:white}
  .card{background:linear-gradient(180deg, var(--panel), var(--panel-2)); border:1px solid #ffffff12; border-radius:18px; padding:18px; box-shadow:0 10px 30px #0003}
  .content{min-height:120px; padding:14px; border-radius:14px; background:var(--soft); border:1px solid #ffffff22; line-height:1.6}
  .content h3{margin:0 0 10px; font-size:21px}
  .meta{display:flex; align-items:center; justify-content:space-between; gap:8px; margin-top:10px; font-size:13px; color:var(--muted)}
  .ctrl-bottom{display:flex; align-items:center; justify-content:center; gap:10px; margin-top:10px; flex-wrap:wrap}
  .nav-btn{border:none; border-radius:999px; padding:12px 20px; background:#2450ff; color:white; font-weight:800; letter-spacing:.3px; cursor:pointer}
  .nav-btn:disabled{opacity:.5; cursor:not-allowed}
  .nav-btn.secondary{background:#d7dcef; color:#1c275f}
  .footer{margin-top:12px; display:flex; align-items:center; justify-content:center; gap:8px; white-space:nowrap; overflow-x:auto; padding:6px 4px}
  .dot{display:inline-block; width:18px; height:18px; border-radius:4px; background:#c9d3ff; border:1px solid #9bb1ff; opacity:.9}
  .dot.done{background:var(--ok); border-color:var(--ok-strong); opacity:1}
  .dot.current{background:var(--ok); border-color:var(--ok-strong); opacity:1}
  .toast{position:fixed; inset:auto 0 22px 0; display:flex; justify-content:center; pointer-events:none}
  .toast > div{background:#101940; color:white; padding:10px 16px; border-radius:12px; box-shadow:0 10px 30px #0007; opacity:0; transform:translateY(8px)}
  .toast.show > div{opacity:1; transform:translateY(0); transition:all .25s ease}
  .hint{font-size:12px; color:var(--muted); text-align:center; margin-top:6px}

.footer-bar {
  display: flex;
  flex-direction: column;      /* tekst pod sobÄ… */
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 14px 8px;
  margin-top: 20px;
  border-top: 1px solid #0001;
  opacity: .9;
  font-size: 15px;
  line-height: 1.6;
}

.dark .footer-bar {
  border-top-color: #ffffff22;
}

.footer-bar a {
  color: inherit;
  text-decoration: none;
  font-weight: 600;
}

.footer-bar button#peekBtn {
  margin-top: 10px;
  width: 36px;
  height: 36px;
  font-weight: 700;
  background: #dbe5ff;
  color: #000033;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: 0.2s ease;
}

.footer-bar button#peekBtn:hover {
  background: #c5d5ff;
}


.field input {
  text-align: center;
}

/* ğŸ“Œ CaÅ‚y pasek (ikonka + imiÄ™ + Start) wyÅ›rodkowany */
.controlbar {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  position: relative;
  margin: 10px auto;
}

/* ğŸ“Œ Menu profili otwiera siÄ™ dokÅ‚adnie pod ikonkÄ… ğŸ‘¤ */
.controlbar .menu {
  position: absolute;
  top: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  z-index: 9999;
  max-width: 280px;
}



</style>
</head>
<body>

  <div class="wrap">
    <header>
      <div class="banner"><h1>Nowenna rozwiÄ…zujÄ…ca wÄ™zÅ‚y</h1></div>
      <div class="controlbar">
        <button id="themeBtn" class="btn toggle" title="Tryb dzieÅ„ / noc">ğŸŒ/ğŸŒ™</button>
        <div class="field">
          <button id="nameBtn" class="btn square" title="Wybierz zapisane imiÄ™">ğŸ‘¤</button>
          <input id="nameInput" type="text" placeholder="np. Ania" maxlength="24" />
          <button id="startBtn" class="btn start">Start</button>
        </div>
        <div id="nameMenu" class="menu" aria-hidden="true"></div>
      </div>
    </header>

    <!-- Pasek informujÄ…cy o trybie podglÄ…du -->
    <div id="previewInfo" class="previewInfo" role="status" aria-live="polite">
      JesteÅ› w trybie podglÄ…du caÅ‚ej nowenny
    </div>

    <div class="card">
      <div id="content" class="content">Podaj imiÄ™ i kliknij â€Startâ€, aby zaczÄ…Ä‡ dzieÅ„ 1. Albo kliknij w ikonkÄ™ postaci, by wybraÄ‡ wczeÅ›niej zapisanych uÅ¼ytkownikÃ³w.</div>
      <div class="meta">
        <div id="metaDay">DzieÅ„ â€“</div>
        <div id="metaStep">Krok â€“/â€“</div>
      </div>

      <div class="ctrl-bottom">
        <button id="prevBottom" class="nav-btn secondary" disabled>âŸµ Wstecz</button>
        <button id="nextBottom" class="nav-btn" disabled>Dalej âŸ¶</button>
      
<div id="footerDots" class="footer" aria-label="PostÄ™p nowenny (dni)"></div>

<footer class="footer-bar">
  <span>â€Nowenna â€” dzieÅ„ po dniuâ€ âœï¸ Â© 2025</span>
  <a href="https://drogawiary.github.io/" rel="noopener"
     style="color:inherit;text-decoration:none;font-weight:600;">
    Strona --> drogawiary@wp.pl
  </a>
  <button id="peekBtn" class="btn square" title="PodglÄ…d wszystkich dni (X)">(i)</button>
</footer>



  </div>

  <div class="toast" id="toast"><div id="toastMsg">â€”</div></div>

<script>
'use strict';

// ğŸ”’ Tryb testÃ³w (blokuje zapisy do localStorage w czasie selfTests)
let TESTING = false;

/* ============================
   BLOKI TREÅšCI â€” peÅ‚na treÅ›Ä‡ (stabilna)
   ============================ */
const SEKWE = `
<h3>Sekwencja do Ducha ÅšwiÄ™tego</h3>
<p>
PrzybÄ…dÅº, Duchu ÅšwiÄ™ty, zeÅ›lij z nieba wziÄ™ty Å›wiatÅ‚a Twego strumieÅ„.<br/>
PrzyjdÅº, Ojcze ubogich, Dawco darÃ³w mnogich, przyjdÅº, ÅšwiatÅ‚oÅ›ci sumieÅ„.<br/>
O najmilszy z goÅ›ci, sÅ‚odka serc radoÅ›ci, sÅ‚odkie orzeÅºwienie.<br/>
W pracy TyÅ› ochÅ‚odÄ…, w skwarze Å¼ywÄ… wodÄ…, w pÅ‚aczu utulenie.<br/>
ÅšwiatÅ‚oÅ›ci najÅ›wiÄ™tsza, serc wierzÄ…cych wnÄ™trza poddaj Twej potÄ™dze.<br/>
Bez Twojego tchnienia cÃ³Å¼ jest wÅ›rÃ³d stworzenia? Jeno cierÅ„ i nÄ™dze.<br/>
Obmyj, co nieÅ›wiÄ™te, oschÅ‚ym wlej zachÄ™tÄ™, ulecz serca ranÄ™.<br/>
Nagnij, co jest harde, rozgrzej serca twarde, prowadÅº zabÅ‚Ä…kane.<br/>
Daj Twoim wierzÄ…cym, w Tobie ufajÄ…cym, siedmiorakie dary.<br/>
Daj zasÅ‚ugÄ™ mÄ™stwa, daj wieniec zwyciÄ™stwa, daj szczÄ™Å›cie bez miary. Amen.
</p>`;

const SKLAD = `
<h3>SkÅ‚ad Apostolski</h3>
<p>
WierzÄ™ w Boga, Ojca wszechmogÄ…cego, Stworzyciela nieba i ziemi.<br/>
I w Jezusa Chrystusa, Syna Jego jedynego, Pana naszego,<br/>
ktÃ³ry siÄ™ poczÄ…Å‚ z Ducha ÅšwiÄ™tego, narodziÅ‚ siÄ™ z Maryi Panny,<br/>
umÄ™czon pod Ponckim PiÅ‚atem, ukrzyÅ¼owan, umarÅ‚ i pogrzebion,<br/>
zstÄ…piÅ‚ do piekieÅ‚, trzeciego dnia zmartwychwstaÅ‚,<br/>
wstÄ…piÅ‚ na niebiosa, siedzi po prawicy Boga Ojca wszechmogÄ…cego,<br/>
stamtÄ…d przyjdzie sÄ…dziÄ‡ Å¼ywych i umarÅ‚ych.<br/>
WierzÄ™ w Ducha ÅšwiÄ™tego, Å›wiÄ™ty KoÅ›ciÃ³Å‚ powszechny,<br/>
Å›wiÄ™tych obcowanie, grzechÃ³w odpuszczenie,<br/>
ciaÅ‚a zmartwychwstanie, Å¼ywot wieczny. Amen.
</p>`;

const AKT_ZALU = `
<h3>Akt Å¼alu</h3>
<p>
BoÅ¼e mÃ³j, z caÅ‚ego serca Å¼aÅ‚ujÄ™ za wszystkie moje grzechy i wyrzekam siÄ™ ich,<br/>
poniewaÅ¼ grzeszÄ…c, nie tylko zasÅ‚uÅ¼yÅ‚em na kary sprawiedliwie przez Ciebie ustanowione,<br/>
ale szczegÃ³lnie dlatego Å¼aÅ‚ujÄ™, Å¼e obraziÅ‚em Ciebie, najwyÅ¼sze dobro<br/>
i jedynie godnego, aby byÄ‡ ponad wszystko kochanym.<br/>
Dlatego z caÅ‚Ä… mocÄ… przyrzekam, z pomocÄ… Å‚aski Twojej,<br/>
juÅ¼ wiÄ™cej nie grzeszyÄ‡ i na przyszÅ‚oÅ›Ä‡ unikaÄ‡ okazji do grzechu. Amen.
</p>`;

const MODL_MARYJA = `
<h3>Modlitwa do Maryi RozwiÄ…zujÄ…cej WÄ™zÅ‚y</h3>
<p>
Matko BoÅ¼a, ktÃ³ra rozwiÄ…zujesz wÄ™zÅ‚y,<nobr></nobr><br/>
Ty wiesz, Å¼e moje Å¼ycie jest peÅ‚ne â€wÄ™zÅ‚Ã³wâ€, ktÃ³re mnie dÅ‚awiÄ…, przytÅ‚aczajÄ… i uciskajÄ….<br/>
Zawierzam siÄ™ Tobie z ufnoÅ›ciÄ…, Å¼e je rozwiÄ…Å¼esz,<br/>
i przez Twe potÄ™Å¼ne wstawiennictwo Pan udzieli mi spokoju serca,<br/>
zdrowia ciaÅ‚a i ducha, i zaprowadzi mnie do nieskoÅ„czonej radoÅ›ci.<br/>
Maryjo, nie pozwÃ³l, bym ulegÅ‚ pokusie,<br/>
ale uwolnij mnie od wszelkiej niewoli, lÄ™ku i niepewnoÅ›ci.<br/>
Udziel mi Twej Å‚aski, abym podÄ…Å¼aÅ‚ wÅ‚aÅ›ciwÄ… Å›cieÅ¼kÄ… i nie popeÅ‚niaÅ‚ bÅ‚Ä™dÃ³w.<br/>
RozwiÄ…Å¼ dziÅ› moje wÄ™zÅ‚y, a kiedy nadejdzie moja godzina,<br/>
rozwiÄ…Å¼ ostatni â€“ wÄ™zeÅ‚ mojej Å›mierci â€“<br/>
abym ostatecznie wolny od jakiegokolwiek grzechu<br/>
mÃ³gÅ‚ wejÅ›Ä‡ do szczÄ™Å›cia wiecznego. Amen.
</p>`;

// â€” PodziÄ™kowanie i ekrany koÅ„cowe â€”
const PODZIEKOWANIE_MARYI = `
<h3>PodziÄ™kowanie Maryi RozwiÄ…zujÄ…cej WÄ™zÅ‚y</h3>
<p>
Maryjo RozwiÄ…zujÄ…ca WÄ™zÅ‚y, z radoÅ›ciÄ… w sercu, z duszÄ… przepeÅ‚nionÄ… wdziÄ™cznoÅ›ciÄ… powracam do Ciebie,<br/>
aby podziÄ™kowaÄ‡ za otrzymane Å‚aski.<br/><br/>

ChcÄ™ byÄ‡ caÅ‚kowicie TwÃ³j. PomÃ³Å¼ mi kroczyÄ‡ wraz z TobÄ… drogÄ… wiernoÅ›ci Jezusowi w Jego KoÅ›ciele.<br/><br/>

DziÄ™kujÄ™, ÅšwiÄ™ta Dziewico, za to, Å¼e zawsze trzymasz mnie z miÅ‚oÅ›ciÄ… za rÄ™kÄ™<br/>
i kierujesz moje serce ku miÅ‚oÅ›ci do Jezusa.<br/><br/>

DziÄ™kujÄ™, Å¼e uczysz mnie szukaÄ‡ mojego dobra jedynie w Bogu,<br/>
ktÃ³ry jest ÅºrÃ³dÅ‚em wszelkiego pokoju i Å‚aski.<br/><br/>

DziÄ™kujÄ™, Å¼e uczysz mnie pragnÄ…Ä‡ wypeÅ‚niania tylko Jego woli,<br/>
aby mÃ³gÅ‚ urzeczywistniaÄ‡ we mnie plan, ktÃ³ry odwiecznie ustanowiÅ‚.<br/><br/>

DziÄ™kujÄ™, Å¼e uczysz mnie Å¼ycia z Jezusem i dla Jezusa.<br/>
DziÄ™kujÄ™ za to, Å¼e kiedy upadnÄ™, pomagasz mi wrÃ³ciÄ‡ do Niego<br/>
w sakramencie pojednania i radoÅ›ci.<br/><br/>

DziÄ™ki niemu, ÅšwiÄ™ta Dziewico, z BoÅ¼ym pokojem w sercu mogÄ™ nieÅ›Ä‡ prawdziwÄ… radoÅ›Ä‡ i prawdziwy pokÃ³j wszystkim.<br/>
WyproÅ› mi wielkÄ… miÅ‚oÅ›Ä‡ do wszystkich sakramentÃ³w â€“ znakÃ³w, ktÃ³re TwÃ³j Syn nam zostawiÅ‚,<br/>
aby siÄ™ w nich z nami spotkaÄ‡.<br/><br/>

DziÄ™kujÄ™, Maryjo, Å¼e opiekujesz siÄ™ mojÄ… rodzinÄ….<br/>
Spraw, aby zawsze pozostaÅ‚a zjednoczona i niezachwiana w nieskoÅ„czonej miÅ‚oÅ›ci Boga.<br/><br/>

DziÄ™kujÄ™, Maryjo, Å¼e udzielasz mojej rodzinie potrzebnych Å‚ask duchowych i materialnych.<br/>
ProszÄ™, pomnÃ³Å¼ w nas wiarÄ™, nadziejÄ™ i miÅ‚oÅ›Ä‡.<br/><br/>

<strong>DziÄ™kujÄ™, Å¼e pozwoliÅ‚aÅ› mi odkryÄ‡ moc tej nowenny. Amen.</strong>
</p>`;

const ZAKONCZ_DZIEN_INFO = `
<h3>UkoÅ„czyÅ‚eÅ› pierwszy dzieÅ„ nowenny</h3>
<p>Jutro, po zalogowaniu, otworzy siÄ™ <strong>kolejny dzieÅ„ nowenny</strong>. Kliknij <em>Dalej</em>, aby zakoÅ„czyÄ‡ dzieÅ„ i wrÃ³ciÄ‡ do poczÄ…tku.</p>`;

const ZAKONCZ_DZIEN_GENERIC = `
<h3>UkoÅ„czyÅ‚eÅ› ten dzieÅ„ nowenny</h3>
<p>Kliknij <em>Dalej</em>, aby wrÃ³ciÄ‡ do poczÄ…tku. Kolejny dzieÅ„ otworzy siÄ™ zgodnie z kalendarzem rozpoczÄ™cia.</p>`;

const ZAKONCZ_DZIEN_FINAL = `
<h3>UkoÅ„czyÅ‚eÅ› caÅ‚Ä… nowennÄ™ ğŸ™â¤ï¸ </h3>
<p>NaciÅ›nij <em>Dalej</em> lub <em>Reset</em>, aby zakoÅ„czyÄ‡ nowennÄ™ i powrÃ³ciÄ‡ do strony startowej.<br/>
Niech Maryja prowadzi CiÄ™ dalej w codziennym Å¼yciu. â¤ï¸ğŸŒ¿</p>`;

// --- Litania i modlitwa Å›w. Bernarda (skrÃ³t) ---
const LITANIA_LORETANSKA = `
<h3>Litania LoretaÅ„ska do NajÅ›wiÄ™tszej Maryi Panny</h3>
<p>
Kyrie eleison, Christe eleison, Kyrie eleison.<br/>
Chryste, usÅ‚ysz nas. Chryste, wysÅ‚uchaj nas.<br/>
Ojcze z nieba, BoÅ¼e â€” zmiÅ‚uj siÄ™ nad nami.<br/>
Synu, Odkupicielu Å›wiata, BoÅ¼e â€” zmiÅ‚uj siÄ™ nad nami.<br/>
Duchu ÅšwiÄ™ty, BoÅ¼e â€” zmiÅ‚uj siÄ™ nad nami.<br/>
ÅšwiÄ™ta TrÃ³jco, Jedyny BoÅ¼e â€” zmiÅ‚uj siÄ™ nad nami.<br/><br/>

ÅšwiÄ™ta Maryjo â€” mÃ³dl siÄ™ za nami.<br/>
ÅšwiÄ™ta BoÅ¼a Rodzicielko â€” mÃ³dl siÄ™ za nami.<br/>
ÅšwiÄ™ta Panno nad pannami â€” mÃ³dl siÄ™ za nami.<br/>
Matko Chrystusowa â€” mÃ³dl siÄ™ za nami.<br/>
Matko KoÅ›cioÅ‚a â€” mÃ³dl siÄ™ za nami.<br/>
Matko Å‚aski BoÅ¼ej â€” mÃ³dl siÄ™ za nami.<br/>
Matko nieskalana â€” mÃ³dl siÄ™ za nami.<br/>
Matko najczystsza â€” mÃ³dl siÄ™ za nami.<br/>
Matko dziewicza â€” mÃ³dl siÄ™ za nami.<br/>
Matko nienaruszona â€” mÃ³dl siÄ™ za nami.<br/>
Matko najmilsza â€” mÃ³dl siÄ™ za nami.<br/>
Matko przedziwna â€” mÃ³dl siÄ™ za nami.<br/>
Matko dobrej rady â€” mÃ³dl siÄ™ za nami.<br/>
Matko Stworzyciela â€” mÃ³dl siÄ™ za nami.<br/>
Matko Zbawiciela â€” mÃ³dl siÄ™ za nami.<br/><br/>

Panno roztropna â€” mÃ³dl siÄ™ za nami.<br/>
Panno czcigodna â€” mÃ³dl siÄ™ za nami.<br/>
Panno wsÅ‚awiona â€” mÃ³dl siÄ™ za nami.<br/>
Panno moÅ¼na â€” mÃ³dl siÄ™ za nami.<br/>
Panno Å‚askawa â€” mÃ³dl siÄ™ za nami.<br/>
Panno wierna â€” mÃ³dl siÄ™ za nami.<br/><br/>

ZwierciadÅ‚o sprawiedliwoÅ›ci â€” mÃ³dl siÄ™ za nami.<br/>
Stolico mÄ…droÅ›ci â€” mÃ³dl siÄ™ za nami.<br/>
Przyczyno naszej radoÅ›ci â€” mÃ³dl siÄ™ za nami.<br/>
Przybytku Ducha ÅšwiÄ™tego â€” mÃ³dl siÄ™ za nami.<br/>
Przybytku chwalebny â€” mÃ³dl siÄ™ za nami.<br/>
Przybytku sÅ‚awny poboÅ¼noÅ›ci â€” mÃ³dl siÄ™ za nami.<br/>
RÃ³Å¼o duchowna â€” mÃ³dl siÄ™ za nami.<br/>
WieÅ¼o Dawidowa â€” mÃ³dl siÄ™ za nami.<br/>
WieÅ¼o z koÅ›ci sÅ‚oniowej â€” mÃ³dl siÄ™ za nami.<br/>
Domie zÅ‚oty â€” mÃ³dl siÄ™ za nami.<br/>
Arko przymierza â€” mÃ³dl siÄ™ za nami.<br/>
Bramo niebieska â€” mÃ³dl siÄ™ za nami.<br/>
Gwiazdo zaranna â€” mÃ³dl siÄ™ za nami.<br/>
Uzdrowienie chorych â€” mÃ³dl siÄ™ za nami.<br/>
Ucieczko grzesznych â€” mÃ³dl siÄ™ za nami.<br/>
Pocieszycielko strapionych â€” mÃ³dl siÄ™ za nami.<br/>
WspomoÅ¼enie wiernych â€” mÃ³dl siÄ™ za nami.<br/><br/>

KrÃ³lowo AnioÅ‚Ã³w â€” mÃ³dl siÄ™ za nami.<br/>
KrÃ³lowo PatriarchÃ³w â€” mÃ³dl siÄ™ za nami.<br/>
KrÃ³lowo ProrokÃ³w â€” mÃ³dl siÄ™ za nami.<br/>
KrÃ³lowo ApostoÅ‚Ã³w â€” mÃ³dl siÄ™ za nami.<br/>
KrÃ³lowo MÄ™czennikÃ³w â€” mÃ³dl siÄ™ za nami.<br/>
KrÃ³lowo WyznawcÃ³w â€” mÃ³dl siÄ™ za nami.<br/>
KrÃ³lowo Dziewic â€” mÃ³dl siÄ™ za nami.<br/>
KrÃ³lowo Wszystkich ÅšwiÄ™tych â€” mÃ³dl siÄ™ za nami.<br/>
KrÃ³lowo bez zmazy pierworodnej poczÄ™ta â€” mÃ³dl siÄ™ za nami.<br/>
KrÃ³lowo WniebowziÄ™ta â€” mÃ³dl siÄ™ za nami.<br/>
KrÃ³lowo RÃ³Å¼aÅ„ca ÅšwiÄ™tego â€” mÃ³dl siÄ™ za nami.<br/>
KrÃ³lowo rodzin â€” mÃ³dl siÄ™ za nami.<br/>
KrÃ³lowo pokoju â€” mÃ³dl siÄ™ za nami.<br/>
KrÃ³lowo Polski â€” mÃ³dl siÄ™ za nami.<br/><br/>

Baranku BoÅ¼y, ktÃ³ry gÅ‚adzisz grzechy Å›wiata â€” przepuÅ›Ä‡ nam, Panie.<br/>
Baranku BoÅ¼y, ktÃ³ry gÅ‚adzisz grzechy Å›wiata â€” wysÅ‚uchaj nas, Panie.<br/>
Baranku BoÅ¼y, ktÃ³ry gÅ‚adzisz grzechy Å›wiata â€” zmiÅ‚uj siÄ™ nad nami.<br/><br/>

<b>W okresie wielkanocnym:</b><br/>
P: Raduj siÄ™ i wesel, Panno Maryjo, Alleluja.<br/>
W: Bo zmartwychwstaÅ‚ Pan prawdziwie, Alleluja.<br/><br/>
MÃ³dlmy siÄ™:<br/>
BoÅ¼e, ktÃ³ry raczyÅ‚eÅ› uweseliÄ‡ Å›wiat przez zmartwychwstanie Syna swego, Pana naszego Jezusa Chrystusa,<br/>
daj prosimy, abyÅ›my przez Jego RodzicielkÄ™, MaryjÄ™ PannÄ™, dostÄ…pili radoÅ›ci Å¼ycia wiecznego.<br/>
Przez Chrystusa, Pana naszego. <strong>Amen.</strong><br/><br/>

<b>Poza okresem wielkanocnym:</b><br/>
P: MÃ³dl siÄ™ za nami, Å›wiÄ™ta BoÅ¼a Rodzicielko.<br/>
W: AbyÅ›my siÄ™ stali godnymi obietnic Chrystusowych.<br/><br/>
MÃ³dlmy siÄ™:<br/>
Panie, nasz BoÅ¼e, daj nam, sÅ‚ugom swoim, cieszyÄ‡ siÄ™ trwaÅ‚ym zdrowiem duszy i ciaÅ‚a,<nobr></nobr><br/>
i za wstawiennictwem NajÅ›wiÄ™tszej Maryi, zawsze Dziewicy,<br/>
uwolnij nas od doczesnych utrapieÅ„ i obdarz wiecznÄ… radoÅ›ciÄ….<br/>
Przez Chrystusa, Pana naszego. <strong>Amen.</strong>
</p>`;

const MODL_SW_BERNARDA = `
<h3>Modlitwa Å›w. Bernarda (Memorare)</h3>
<p>
Pomnij, o NajÅ›wiÄ™tsza Panno Maryjo,<br/>
Å¼e nigdy nie sÅ‚yszano,<br/>
abyÅ› opuÅ›ciÅ‚a tego,<br/>
kto siÄ™ do Ciebie ucieka,<br/>
Twej pomocy wzywa,<br/>
Ciebie o przyczynÄ™ prosi.<br/><br/>

TÄ… ufnoÅ›ciÄ… oÅ¼ywiony,<br/>
do Ciebie, o Panno nad pannami i Matko, biegnÄ™,<br/>
do Ciebie przychodzÄ™,<br/>
przed TobÄ… jako grzesznik pÅ‚aczÄ…cy stajÄ™.<br/><br/>

O Matko SÅ‚owa,<br/>
racz nie gardziÄ‡ sÅ‚owami moimi,<br/>
ale usÅ‚ysz je Å‚askawie i wysÅ‚uchaj.<br/><br/>
<strong>Amen.</strong>
</p>`;

const CLOSING_PRAYER = `
<h3>Modlitwa do Maryi RozwiÄ…zujÄ…cej WÄ™zÅ‚y</h3>
<p>
O Maryjo, Matko Chrystusa i KoÅ›cioÅ‚a, KrÃ³lowo narodÃ³w i rodzin,<br/>
Ty, ktÃ³ra nosiÅ‚aÅ› w swym Å‚onie Syna BoÅ¼ego, Tego, ktÃ³ry zÅ‚amaÅ‚ jarzmo,<br/>
jakie trzymaÅ‚o nas w niewoli grzechu, wyproÅ› nam Å‚askÄ™ pozostania<br/>
w prawdziwej wolnoÅ›ci dzieci BoÅ¼ych.<br/><br/>

Twoimi Å›wiÄ™tymi dÅ‚oÅ„mi, Najczystsza Dziewico, KrÃ³lowo pokoju,<nobr></nobr><br/>
rozwiÄ…Å¼ splÄ…tane wÄ™zÅ‚y, ktÃ³re sprawiajÄ…, Å¼e nasze Å¼ycie<br/>
jest smutne i skomplikowane.<br/><br/>

PomÃ³Å¼ nam oddaÄ‡ siÄ™ sÅ‚uÅ¼bie dobru z czystoÅ›ciÄ… i prostotÄ… serca,<br/>
zawsze w gotowoÅ›ci do przebaczenia i pojednania.<br/>
Spraw, abyÅ›my â€“ nie stawiajÄ…c niczego ponad miÅ‚oÅ›Ä‡ Chrystusa â€“<br/>
w Jego miÅ‚oÅ›ci szczerze kochali naszych braci.<br/><br/>

<strong>Amen.</strong>
</p>`;

// --- Tajemnice rÃ³Å¼aÅ„ca (peÅ‚ne z wersji stabilnej) ---
const MYSTERIES = {
  radosne: {
    name: 'tajemnice radosne',
    first3: [
      {t:'Zwiastowanie', m:'ProÅ›my o gotowoÅ›Ä‡ przyjÄ™cia woli BoÅ¼ej jak Maryja.'},
      {t:'Nawiedzenie Å›w. ElÅ¼biety', m:'Ucz mnie sÅ‚uÅ¼by i wraÅ¼liwoÅ›ci na potrzeby innych.'},
      {t:'Narodzenie Pana Jezusa', m:'OddajÄ™ Ci moje domy i relacje â€” niech bÄ™dÄ… miejscem pokoju.'}
    ],
    last2: [
      {t:'Ofiarowanie w Å›wiÄ…tyni', m:'PrzynoszÄ™ Ci, Panie, moje plany i lÄ™ki o przyszÅ‚oÅ›Ä‡.'},
      {t:'Odnalezienie w Å›wiÄ…tyni', m:'OdnajdÅº mnie, gdy siÄ™ gubiÄ™; daj pragnienie Twojej mÄ…droÅ›ci.'}
    ]
  },
  bolesne: {
    name: 'tajemnice bolesne',
    first3: [
      {t:'Modlitwa w OgrÃ³jcu', m:'Ucz mnie mÃ³wiÄ‡: nie moja, lecz Twoja wola niech siÄ™ stanie.'},
      {t:'Biczowanie', m:'ZÅ‚Ä…cz moje cierpienia z Twoimi â€” uzdrÃ³w serce.'},
      {t:'Cierniem ukoronowanie', m:'Daj pokorÄ™, gdy spotyka mnie niesprawiedliwoÅ›Ä‡.'}
    ],
    last2: [
      {t:'DÅºwiganie krzyÅ¼a', m:'Ucz mnie wytrwaÅ‚oÅ›ci i miÅ‚oÅ›ci w trudnoÅ›ciach.'},
      {t:'ÅšmierÄ‡ na krzyÅ¼u', m:'Przebacz, jak Ty przebaczyÅ‚eÅ› â€” zwÅ‚aszcza najtrudniejszym.'}
    ]
  },
  chwalebne: {
    name: 'tajemnice chwalebne',
    first3: [
      {t:'Zmartwychwstanie', m:'OdnÃ³w mojÄ… nadziejÄ™ i radoÅ›Ä‡ wiary.'},
      {t:'WniebowstÄ…pienie', m:'UczyÅ„ mnie Å›wiadkiem Twojej miÅ‚oÅ›ci w codziennoÅ›ci.'},
      {t:'ZesÅ‚anie Ducha ÅšwiÄ™tego', m:'NapeÅ‚nij mnie darami Ducha dla sÅ‚uÅ¼by.'}
    ],
    last2: [
      {t:'WniebowziÄ™cie NMP', m:'Ucz mnie ufaÄ‡ jak Maryja, aÅ¼ do koÅ„ca.'},
      {t:'Ukoronowanie NMP', m:'Niech Maryja krÃ³luje w moim sercu i domu.'}
    ]
  },
  swiatla: {
    name: 'tajemnice Å›wiatÅ‚a',
    first3: [
      {t:'Chrzest w Jordanie', m:'DziÄ™kujÄ™ za moje powoÅ‚anie i chrzest â€” odnowisz we mnie Å‚askÄ™.'},
      {t:'Kana Galilejska', m:'Ulecz to, co sÅ‚abnie w miÅ‚oÅ›ci â€” przemieniaj wodÄ™ codziennoÅ›ci w wino Å‚aski.'},
      {t:'GÅ‚oszenie KrÃ³lestwa', m:'Daj mi nawrÃ³cenie serca i wiernoÅ›Ä‡ Ewangelii.'}
    ],
    last2: [
      {t:'Przemienienie', m:'RozjaÅ›nij moje decyzje Twoim Å›wiatÅ‚em.'},
      {t:'Eucharystia', m:'UczyÅ„ moje serce eucharystycznym: wdziÄ™czne i oddane.'}
    ]
  }
};

// â€” Indywidualne modlitwy dnia (dla kaÅ¼dego z 9 dni)
const DAILY_PRAYERS_BY_DAY = {
  1: `<h3>RozwaÅ¼anie dnia â€” DzieÅ„ 1</h3>
  <p>Maryjo, Ty jesteÅ› peÅ‚na Å‚aski. Wiara mÃ³wi mi, Å¼e swojÄ… mocÄ… przed Bogiem wyprosisz mi to, o co CiÄ™ proszÄ™, poniewaÅ¼ bÄ™dÄ…c MatkÄ…, chcesz mnie wysÅ‚uchaÄ‡.<br/>
  ProszÄ™, wysÅ‚uchaj mojej proÅ›by, jestem pewien, Å¼e zawsze masz lekarstwo na moje sÅ‚aboÅ›ci, nawet jeÅ›li wydaje siÄ™, Å¼e juÅ¼ nic nie da siÄ™ zrobiÄ‡.<br/><br/>
  Maryjo peÅ‚na Å‚aski, ktÃ³ra rozwiÄ…zujesz wÄ™zÅ‚y dÅ‚awiÄ…ce Twoje dzieci, wyciÄ…gnij ku mnie swoje miÅ‚osierne rÄ™ce. OddajÄ™ Ci dzisiaj ten wÄ™zeÅ‚ (wymieniÄ‡) i wszystkie jego negatywne konsekwencje w moim Å¼yciu.<br/>
  OddajÄ™ Ci ten wÄ™zeÅ‚ (wymieniÄ‡), ktÃ³ry drÄ™czy mnie i nie pozwala mi Å¼yÄ‡ w BoÅ¼ym pokoju.<br/><br/>
  O Maryjo, ktÃ³ra rozwiÄ…zujesz wÄ™zÅ‚y, wiem, Å¼e nigdy nie sÅ‚yszano, by ktokolwiek uciekajÄ…c siÄ™ do Ciebie, bÅ‚agajÄ…c o TwojÄ… pomoc i ochronÄ™, zostaÅ‚ odrzucony.<br/>
  WierzÄ™ zatem, Å¼e moÅ¼esz rÃ³wnieÅ¼ rozwiÄ…zaÄ‡ mÃ³j wÄ™zeÅ‚, poniewaÅ¼ Jezus, TwÃ³j umiÅ‚owany Syn, udziela Ci wszelkiej wÅ‚adzy.<br/>
  Ufam, Å¼e go rozwiÄ…Å¼esz, poniewaÅ¼ jesteÅ› mojÄ… MatkÄ…. Wiem, Å¼e to zrobisz, poniewaÅ¼ kochasz mnie samÄ… miÅ‚oÅ›ciÄ… Boga. DziÄ™kujÄ™ Ci, moja umiÅ‚owana Matko.<br/><br/>
  O Maryjo, Matko Dobrej Rady, weÅº ten wÄ™zeÅ‚ (wymieniÄ‡), ktÃ³ry mi przeszkadza, i TwojÄ… mocnÄ… rÄ™kÄ… rozwiÄ…Å¼ go.<br/>
  Maryjo RozwiÄ…zujÄ…ca WÄ™zÅ‚y, mÃ³dl siÄ™ za mnÄ….</p>`,

  2: `<h3>RozwaÅ¼anie dnia â€” DzieÅ„ 2</h3>
  <p>Maryjo, Matko PiÄ™knej MiÅ‚oÅ›ci, moje serce zwraca siÄ™ do Ciebie, ktÃ³ra znalazÅ‚aÅ› Å‚askÄ™ u Boga.<br/>
  Ty, ktÃ³ra przyjmujÄ…c pozdrowienie anioÅ‚a ku zdumieniu caÅ‚ego stworzenia, wydaÅ‚aÅ› na Å›wiat swego StwÃ³rcÄ™, Matko dziewicza, miej litoÅ›Ä‡ dla mnie grzesznika.<br/><br/>
  WstrzÄ…sajÄ… mnÄ… fale pychy, ambicji, oszczerstw, zazdroÅ›ci, gniewu, chciwoÅ›ci i poÅ¼Ä…dania ciaÅ‚a.<br/>
  Zwracam siÄ™ do Ciebie, Matko RozwiÄ…zujÄ…ca WÄ™zÅ‚y, abyÅ› wyprosiÅ‚a mi u Twego Syna Jezusa Å‚askÄ™ czystoÅ›ci serca, wolnoÅ›ci od przywiÄ…zywania siÄ™, Å‚askÄ™ pokory, poddania siÄ™ i zaufania Bogu.<br/>
  ZobowiÄ…zujÄ™ siÄ™ dziÅ› do praktykowania tych cnÃ³t w dowÃ³d mojej miÅ‚oÅ›ci do Ciebie.<br/><br/>
  OddajÄ™ w Twoje rÄ™ce ten wÄ™zeÅ‚ (wymieniÄ‡), ktÃ³ry uniemoÅ¼liwia mi bycie odbiciem chwaÅ‚y BoÅ¼ej. Nie gardÅº moim bÅ‚aganiem, ale mnie wysÅ‚uchaj.<br/>
  Daj mi, Matko Boga i moja Matko, iskierkÄ™ Twojej miÅ‚oÅ›ci do Jezusa.<br/><br/>
  O Maryjo, Matko Dobrej Rady, weÅº ten wÄ™zeÅ‚ (wymieniÄ‡), ktÃ³ry mi przeszkadza, i TwojÄ… mocnÄ… rÄ™kÄ… rozwiÄ…Å¼ go.<br/>
  Maryjo RozwiÄ…zujÄ…ca WÄ™zÅ‚y, mÃ³dl siÄ™ za mnÄ….</p>`,

  3: `<h3>RozwaÅ¼anie dnia â€” DzieÅ„ 3</h3>
  <p>Niech w kaÅ¼dej osobie dusza Maryi wywyÅ¼sza Pana, niech w kaÅ¼dym czÅ‚owieku dusza Maryi raduje siÄ™ w Bogu.<br/>
  Matko BoÅ¼a i nasza Matko, umocnij mojÄ… wiarÄ™, ktÃ³ra jest tak krucha i niepewna.<br/><br/>
  Maryjo PoÅ›redniczko, Twoje rÄ™ce przyjmujÄ… i rozdajÄ… wszystkie bogactwa KrÃ³la.<br/>
  ZwrÃ³Ä‡ ku mnie swoje miÅ‚osierne oczy. SkÅ‚adam w Twoje Å›wiÄ™te dÅ‚onie ten wÄ™zeÅ‚ mojego Å¼ycia (wymieniÄ‡) i wszystkie zÅ‚e skutki i grzechy, ktÃ³rych jest ÅºrÃ³dÅ‚em.<br/><br/>
  PomÃ³Å¼ mi teraz wybaczyÄ‡ wszystkim osobom, ktÃ³re Å›wiadomie lub nieÅ›wiadomie przyczyniÅ‚y siÄ™ do tego wÄ™zÅ‚a.<br/>
  Przed TobÄ…, umiÅ‚owana Matko, i w imiÄ™ Twojego Syna Jezusa, mojego Zbawiciela, ktÃ³ry byÅ‚ tak obraÅ¼any i umiaÅ‚ przebaczyÄ‡, teraz wybaczam tym ludziom (wymieniÄ‡) na zawsze.<br/><br/>
  O Maryjo, Matko Dobrej Rady, weÅº ten wÄ™zeÅ‚ (wymieniÄ‡), ktÃ³ry mi przeszkadza, i TwojÄ… mocnÄ… rÄ™kÄ… rozwiÄ…Å¼ go.<br/>
  Maryjo RozwiÄ…zujÄ…ca WÄ™zÅ‚y, mÃ³dl siÄ™ za mnÄ….</p>`,

  4: `<h3>RozwaÅ¼anie dnia â€” DzieÅ„ 4</h3>
  <p>Matko wielkiej miÅ‚oÅ›ci, Å¼yczliwa dla wszystkich potrzebujÄ…cych, przyjdÅº mi z pomocÄ…, tak jak pospieszyÅ‚aÅ› do ElÅ¼biety.<br/>
  SkÅ‚adam w Twoje rÄ™ce ten wÄ™zeÅ‚ (wymieniÄ‡), ktÃ³ry uniemoÅ¼liwia mi bycie spokojnym, paraliÅ¼uje mojÄ… duszÄ™, uniemoÅ¼liwiajÄ…c mi przyjÅ›cie do mojego Pana i oddanie Å¼ycia na Jego sÅ‚uÅ¼bÄ™.<br/><br/>
  Matko, rozwiÄ…Å¼ ten wÄ™zeÅ‚ mojego Å¼ycia (wymieniÄ‡). ProÅ› Jezusa, aby uzdrowiÅ‚ mojÄ… odrÄ™twiaÅ‚Ä… wiarÄ™, ktÃ³ra pozwala siÄ™ pokonaÄ‡ przez kaÅ¼dÄ… trudnoÅ›Ä‡.<br/><br/>
  BÄ…dÅº ze mnÄ…, umiÅ‚owana Matko, abym uÅ›wiadomiÅ‚ sobie, Å¼e przeszkody, jakie napotykam na swojej drodze, sÄ… okazjÄ… do umocnienia mnie w wierze i nauczenia siÄ™ wdziÄ™cznoÅ›ci Bogu, ktÃ³ry nie przestaje mnie wspieraÄ‡ swojÄ… opatrznoÅ›ciÄ….<br/><br/>
  O Maryjo, Matko Dobrej Rady, weÅº ten wÄ™zeÅ‚ (wymieniÄ‡), ktÃ³ry mi przeszkadza, i TwojÄ… mocnÄ… rÄ™kÄ… rozwiÄ…Å¼ go.<br/>
  Maryjo RozwiÄ…zujÄ…ca WÄ™zÅ‚y, mÃ³dl siÄ™ za mnÄ….</p>`,

  5: `<h3>RozwaÅ¼anie dnia â€” DzieÅ„ 5</h3>
  <p>Maryjo, wielkoduszna i peÅ‚na wspÃ³Å‚czucia, ktÃ³ra rozwiÄ…zujesz najbardziej zawikÅ‚ane wÄ™zÅ‚y, zwracam siÄ™ do Ciebie, aby jeszcze raz oddaÄ‡ ten wÄ™zeÅ‚ (wymieniÄ‡) w Twoje rÄ™ce.<br/>
  ProszÄ™ CiÄ™ o BoÅ¼Ä… mÄ…droÅ›Ä‡, abym dziaÅ‚aÅ‚ w Å›wietle Ducha ÅšwiÄ™tego i rozwiÄ…zaÅ‚ wszelkie trudnoÅ›ci.<br/><br/>
  Twoje sÅ‚owa sÄ… tak peÅ‚ne sÅ‚odyczy, Å¼e moÅ¼na w Tobie ujrzeÄ‡ Serce Boga.<br/>
  Uwolnij mnie od goryczy, gniewu i nienawiÅ›ci, jakie zrodziÅ‚ we mnie ten wÄ™zeÅ‚ (wymieniÄ‡), ktÃ³ry usilnie Ci przedstawiÅ‚em.<br/><br/>
  UmiÅ‚owana Matko, obdarz mnie TwojÄ… sÅ‚odyczÄ… i mÄ…droÅ›ciÄ…, abym nauczyÅ‚ siÄ™ rozwaÅ¼aÄ‡ wszystko w ciszy, w swoim sercu, prowadzÄ…c z Panem peÅ‚en miÅ‚oÅ›ci dialog o wszystkim, co mi siÄ™ przydarza.<br/><br/>
  O Maryjo, Matko Dobrej Rady, weÅº ten wÄ™zeÅ‚ (wymieniÄ‡), ktÃ³ry mi przeszkadza, i TwojÄ… mocnÄ… rÄ™kÄ… rozwiÄ…Å¼ go.<br/>
  Maryjo RozwiÄ…zujÄ…ca WÄ™zÅ‚y, mÃ³dl siÄ™ za mnÄ….</p>`,

  6: `<h3>RozwaÅ¼anie dnia â€” DzieÅ„ 6</h3>
  <p>Matko, podobnie jak apostoÅ‚ Jan chcÄ™ CiÄ™ zabraÄ‡ do mego domu, w gÅ‚Ä™biÄ™ mego serca, aby nauczyÄ‡ siÄ™ od Ciebie, jak upodobniÄ‡ siÄ™ do Twego Syna.<br/>
  StojÄ™ przed TobÄ…, aby powierzyÄ‡ siÄ™ Twojej matczynej trosce.<br/><br/>
  KrÃ³lowo MiÅ‚osierdzia, zawierzam Ci ten wÄ™zeÅ‚ mego Å¼ycia (wymieniÄ‡) i proszÄ™, abyÅ› daÅ‚a mi serce, ktÃ³re potrafi byÄ‡ cierpliwe, podczas gdy Ty rozwiÄ…zujesz to poplÄ…tanie.<br/><br/>
  Naucz mnie wytrwale sÅ‚uchaÄ‡ sÅ‚Ã³w Twojego Syna, przyjmowaÄ‡ sakramenty pojednania i Eucharystii.<br/>
  I tak jak to czyniÅ‚aÅ› w Wieczerniku przed zesÅ‚aniem Ducha ÅšwiÄ™tego, wstawiaj siÄ™ u Twego umiÅ‚owanego Syna, aby udzieliÅ‚ mi obficie Ducha ÅšwiÄ™tego.<br/><br/>
  Niech Duch ÅšwiÄ™ty otworzy moje serce na pokÃ³j, sprawiedliwoÅ›Ä‡ i miÅ‚oÅ›Ä‡.<br/><br/>
  O Maryjo, Matko Dobrej Rady, weÅº ten wÄ™zeÅ‚ (wymieniÄ‡), ktÃ³ry mi przeszkadza, i TwojÄ… mocnÄ… rÄ™kÄ… rozwiÄ…Å¼ go.<br/>
  Maryjo RozwiÄ…zujÄ…ca WÄ™zÅ‚y, mÃ³dl siÄ™ za mnÄ….</p>`,

  7: `<h3>RozwaÅ¼anie dnia â€” DzieÅ„ 7</h3>
  <p>Najczystsza i Niepokalana Maryjo, zwracam siÄ™ dziÅ› do Ciebie. BÅ‚agam CiÄ™, abyÅ› rozwiÄ…zaÅ‚a ten wÄ™zeÅ‚ mego Å¼ycia (wymieniÄ‡) i uwolniÅ‚a mnie od uczynkÃ³w zÅ‚a.<br/>
  BÃ³g daÅ‚ Ci wielkÄ… moc nad wszystkimi demonami. DziÅ› wyrzekam siÄ™ zÅ‚a i wszelkich wiÄ™zÃ³w, ktÃ³re mnie z nim Å‚Ä…czyÅ‚y.<br/>
  OgÅ‚aszam, Å¼e Jezus jest moim jedynym Zbawicielem i Panem.<br/><br/>
  O Maryjo, ktÃ³ra rozwiÄ…zujesz wÄ™zÅ‚y, zmiaÅ¼dÅ¼ gÅ‚owÄ™ ZÅ‚ego. Zniszcz puÅ‚apki, ktÃ³re przyczyniÅ‚y siÄ™ do powstania wÄ™zÅ‚Ã³w w moim Å¼yciu.<br/><br/>
  Tobie, Jutrzenko Zbawienia, polecam mojÄ… drogÄ™, abym pod Twoim przewodnictwem odkryÅ‚ Chrystusa â€” Å›wiatÅ‚oÅ›Ä‡ Å›wiata i Zbawiciela.<br/>
  Panie, uwolnij mnie przez moc Twojej drogocennej krwi.<br/><br/>
  O Maryjo, Matko Dobrej Rady, weÅº ten wÄ™zeÅ‚ (wymieniÄ‡), ktÃ³ry mi przeszkadza, i TwojÄ… mocnÄ… rÄ™kÄ… rozwiÄ…Å¼ go.<br/>
  Maryjo RozwiÄ…zujÄ…ca WÄ™zÅ‚y, mÃ³dl siÄ™ za mnÄ….</p>`,

  8: `<h3>RozwaÅ¼anie dnia â€” DzieÅ„ 8</h3>
  <p>Dziewicza Matko BoÅ¼a, bogata w miÅ‚osierdzie, zmiÅ‚uj siÄ™ nade mnÄ… i rozwiÄ…Å¼ ten wÄ™zeÅ‚ mego Å¼ycia (wymieniÄ‡).<br/>
  PotrzebujÄ™, byÅ› mnie nawiedziÅ‚a tak jak ElÅ¼bietÄ™. PrzynieÅ› mi Jezusa, aby On udzieliÅ‚ mi Ducha ÅšwiÄ™tego.<br/><br/>
  Naucz mnie praktykowaÄ‡ cnotÄ™ pokory, miÅ‚oÅ›ci i â€” podobnie jak ElÅ¼biecie â€” wyproÅ› mi, bym zostaÅ‚ napeÅ‚niony Duchem ÅšwiÄ™tym i radoÅ›ciÄ… bez koÅ„ca.<br/><br/>
  Maryjo, Matko moja, oddajÄ™ Ci moje serce i wszystko, co do mnie naleÅ¼y: mÃ³j dom, rodzinÄ™, dobra materialne i duchowe.<br/>
  Daj mi Twoje serce, abym mÃ³gÅ‚ wypeÅ‚niaÄ‡ wolÄ™ BoÅ¼Ä… kaÅ¼dego dnia mego Å¼ycia.<br/><br/>
  O Maryjo, Matko Dobrej Rady, weÅº ten wÄ™zeÅ‚ (wymieniÄ‡), ktÃ³ry mi przeszkadza, i TwojÄ… mocnÄ… rÄ™kÄ… rozwiÄ…Å¼ go.<br/>
  Maryjo RozwiÄ…zujÄ…ca WÄ™zÅ‚y, mÃ³dl siÄ™ za mnÄ….</p>`,

  9: `<h3>RozwaÅ¼anie dnia â€” DzieÅ„ 9</h3>
  <p>Uciekam siÄ™ do Ciebie, najczystsza Dziewico i Matko moja. Nie gardÅº moim bÅ‚aganiem, ale pochyl siÄ™ do mojej proÅ›by i wysÅ‚uchaj mnie.<br/>
  RozwiÄ…Å¼, proszÄ™, ten wÄ™zeÅ‚ w moim Å¼yciu (wymieniÄ‡). Ty wiesz, jakiego bÃ³lu i cierpienia mi przysparza.<br/><br/>
  DziÄ™kujÄ™, Matko, bo w swoim miÅ‚osierdziu ocierasz moje Å‚zy.<br/>
  DziÄ™kujÄ™, Å¼e przyjmujesz mnie w swoje ramiona i przygotowujesz mnie do otrzymania kolejnej Å‚aski od Boga.<br/>
  Maryjo, ktÃ³ra rozwiÄ…zujesz wÄ™zÅ‚y, i moja ukochana Matko, dziÄ™kujÄ™ za rozwiÄ…zywanie wÄ™zÅ‚Ã³w mego Å¼ycia.<br/><br/>
  Maryjo, bÄ…dÅº dla mnie przykÅ‚adem i przewodniczkÄ…. Okryj mnie Twoim pÅ‚aszczem miÅ‚oÅ›ci i napeÅ‚nij mnie pokojem, jaki tylko BÃ³g moÅ¼e mi daÄ‡.<br/><br/>
  O Maryjo, Matko Dobrej Rady, weÅº ten wÄ™zeÅ‚ (wymieniÄ‡), ktÃ³ry mi przeszkadza, i TwojÄ… mocnÄ… rÄ™kÄ… rozwiÄ…Å¼ go.<br/>
  Maryjo RozwiÄ…zujÄ…ca WÄ™zÅ‚y, mÃ³dl siÄ™ za mnÄ….</p>`
};

/* ============================
   [NOWE] â€” Ekran OPISU (krok pomocniczy)
   ============================ */
const INTRO_HTML = `
<h3>Opis nowenny</h3>
<p>Nowenna do Maryi RozwiÄ…zujÄ…cej WÄ™zÅ‚y to modlitwa powierzajÄ…ca Matce BoÅ¼ej trudne, â€poplÄ…taneâ€ sprawy Å¼ycia â€“ grzechy, naÅ‚ogi, konflikty czy cierpienia, ktÃ³re czÅ‚owiek sam nie potrafi rozwiÄ…zaÄ‡. Jej ÅºrÃ³dÅ‚a siÄ™gajÄ… XVII wieku (obraz w Augsburgu), ale szczegÃ³lnÄ… popularnoÅ›Ä‡ zdobyÅ‚a dziÄ™ki propagowaniu przez papieÅ¼a Franciszka, jeszcze gdy byÅ‚ arcybiskupem Buenos Aires. W KoÅ›ciele katolickim cieszy siÄ™ duÅ¼ym uznaniem jako skuteczna forma wstawiennictwa Maryi â€“ wielu wiernych Å›wiadczy o otrzymanych Å‚askach i przemianach, dlatego jest dziÅ› jednÄ… z najbardziej rozpowszechnionych nowenn maryjnych na Å›wiecie.</p>

<p>Nowenna obejmuje dziewiÄ™Ä‡ dni modlitwy, podczas ktÃ³rych prosimy MaryjÄ™, aby rozwiÄ…zaÅ‚a wÄ™zeÅ‚ konkretnej trudnoÅ›ci. KaÅ¼dego dnia powierzamy Jej serce i Å¼ycie w duchu zaufania, modlÄ…c siÄ™ na rÃ³Å¼aÅ„cu i rozwaÅ¼ajÄ…c tajemnice Chrystusa.</p>

<p>Kliknij <strong>â€Dalejâ€</strong>, aby rozpoczÄ…Ä‡ dzieÅ„ pierwszy nowenny.</p>
`;


function mysteriesLinksHTML(){
  return `
  <h3>CzÄ™Å›ci rÃ³Å¼aÅ„ca (tajemnice z dnia)</h3>
  <p>Kliknij w aktualny dzieÅ„ tygodnia, aby przejÅ›Ä‡ dalej.</p>
  <ul>
    <li><a data-rosary='radosne' href='#tajemnice-radosne'>PoniedziaÅ‚ek â€“ radosne</a></li>
    <li><a data-rosary='bolesne' href='#tajemnice-bolesne'>Wtorek â€“ bolesne</a></li>
    <li><a data-rosary='chwalebne' href='#tajemnice-chwalebne'>Åšroda â€“ chwalebne</a></li>
    <li><a data-rosary='swiatla' href='#tajemnice-swiatla'>Czwartek â€“ Å›wiatÅ‚a</a></li>
    <li><a data-rosary='bolesne' href='#tajemnice-bolesne'>PiÄ…tek â€“ bolesne</a></li>
    <li><a data-rosary='radosne' href='#tajemnice-radosne'>Sobota â€“ radosne</a></li>
    <li><a data-rosary='chwalebne' href='#tajemnice-chwalebne'>Niedziela â€“ chwalebne</a></li>
  </ul>
  <p class='hint'>W Å›rodku uÅ¼ywaj przyciskÃ³w â€Wstecz/Dalejâ€.</p>`;
}

// --- Kroki dzienne â€” SZABLON I PEÅNE 9 DNI (jak w stabilnej) ---
function buildDay(intencje, {finalInfo=false} = {}){
  const arr = [
    ...intencje,
    mysteriesLinksHTML(),
    PODZIEKOWANIE_MARYI
  ];
  if(finalInfo===true){
    arr.push(ZAKONCZ_DZIEN_INFO);
  } else if(finalInfo==='generic'){
    arr.push(ZAKONCZ_DZIEN_GENERIC);
  } else if(finalInfo==='final'){
    arr.push(ZAKONCZ_DZIEN_FINAL);
  }
  return arr;
}

const DAYS = [
  // 1
  buildDay([
    '<h3>DzieÅ„ 1 nowenny</h3><p>âœï¸ W imiÄ™ Ojca i Syna i Ducha ÅšwiÄ™tego. Amen.<br/>Powierzam Ci, Panie, wszystkie wÄ™zÅ‚y mojego Å¼ycia.</p><p class="wezel-info"><em>A w tej nowennie powierzam wÄ™zeÅ‚ (â€¦) </em></p>',
    SEKWE,
    SKLAD,
    AKT_ZALU,
    MODL_MARYJA
  ], { finalInfo:true }),

  // 2
  buildDay([
    '<h3>DzieÅ„ 2 nowenny</h3><p>âœï¸ W imiÄ™ Ojca i Syna i Ducha ÅšwiÄ™tego. Amen.<br/>Powierzam Ci, Panie, wszystkie wÄ™zÅ‚y mojego Å¼ycia.</p><p class="wezel-info"><em>A w tej nowennie powierzam wÄ™zeÅ‚ (â€¦) </em></p>',
    SEKWE,
    SKLAD,
    AKT_ZALU,
    MODL_MARYJA
  ], { finalInfo:'generic' }),

  // 3
  buildDay([
    '<h3>DzieÅ„ 3 nowenny</h3><p>âœï¸ W imiÄ™ Ojca i Syna i Ducha ÅšwiÄ™tego. Amen.<br/>Powierzam Ci, Panie, wszystkie wÄ™zÅ‚y mojego Å¼ycia.</p><p class="wezel-info"><em>A w tej nowennie powierzam wÄ™zeÅ‚ (â€¦) </em></p>',
    SEKWE,
    SKLAD,
    AKT_ZALU,
    MODL_MARYJA
  ], { finalInfo:'generic' }),

  // 4
  buildDay([
    '<h3>DzieÅ„ 4 nowenny</h3><p>âœï¸ W imiÄ™ Ojca i Syna i Ducha ÅšwiÄ™tego. Amen.<br/>Powierzam Ci, Panie, wszystkie wÄ™zÅ‚y mojego Å¼ycia.</p><p class="wezel-info"><em>A w tej nowennie powierzam wÄ™zeÅ‚ (â€¦) </em></p>',
    SEKWE,
    SKLAD,
    AKT_ZALU,
    MODL_MARYJA
  ], { finalInfo:'generic' }),

  // 5
  buildDay([
    '<h3>DzieÅ„ 5 nowenny</h3><p>âœï¸ W imiÄ™ Ojca i Syna i Ducha ÅšwiÄ™tego. Amen.<br/>Powierzam Ci, Panie, wszystkie wÄ™zÅ‚y mojego Å¼ycia.</p><p class="wezel-info"><em>A w tej nowennie powierzam wÄ™zeÅ‚ (â€¦) </em></p>',
    SKLAD,
    AKT_ZALU,
    MODL_MARYJA
  ], { finalInfo:'generic' }),

  // 6
  buildDay([
    '<h3>DzieÅ„ 6 nowenny</h3><p>âœï¸ W imiÄ™ Ojca i Syna i Ducha ÅšwiÄ™tego. Amen.<br/>Powierzam Ci, Panie, wszystkie wÄ™zÅ‚y mojego Å¼ycia.</p><p class="wezel-info"><em>A w tej nowennie powierzam wÄ™zeÅ‚ (â€¦) </em></p>',
    SEKWE,
    SKLAD,
    AKT_ZALU,
    MODL_MARYJA
  ], { finalInfo:'generic' }),

  // 7
  buildDay([
    '<h3>DzieÅ„ 7 nowenny</h3><p>âœï¸ W imiÄ™ Ojca i Syna i Ducha ÅšwiÄ™tego. Amen.<br/>Powierzam Ci, Panie, wszystkie wÄ™zÅ‚y mojego Å¼ycia.</p><p class="wezel-info"><em>A w tej nowennie powierzam wÄ™zeÅ‚ (â€¦) </em></p>',
    SEKWE,
    SKLAD,
    AKT_ZALU,
    MODL_MARYJA
  ], { finalInfo:'generic' }),

  // 8
  buildDay([
    '<h3>DzieÅ„ 8 nowenny</h3><p>âœï¸ W imiÄ™ Ojca i Syna i Ducha ÅšwiÄ™tego. Amen.<br/>Powierzam Ci, Panie, wszystkie wÄ™zÅ‚y mojego Å¼ycia.</p><p class="wezel-info"><em>A w tej nowennie powierzam wÄ™zeÅ‚ (â€¦) </em></p>',
    SKLAD,
    AKT_ZALU,
    MODL_MARYJA
  ], { finalInfo:'generic' }),

  // 9
  buildDay([
    '<h3>DzieÅ„ 9 nowenny</h3><p>âœï¸ W imiÄ™ Ojca i Syna i Ducha ÅšwiÄ™tego. Amen.<br/>Powierzam Ci, Panie, wszystkie wÄ™zÅ‚y mojego Å¼ycia.</p><p class="wezel-info"><em>A w tej nowennie powierzam wÄ™zeÅ‚ (â€¦) </em></p>',
    SKLAD,
    AKT_ZALU,
    MODL_MARYJA
  ], { finalInfo:'final' })

];

// --- UI refs i stan ---
const LS_THEME = 'nowenna_theme';
const LS_PREFIX = 'nowenna_wezly_';

const ui = {
  themeBtn: document.getElementById('themeBtn'),
  nameInput: document.getElementById('nameInput'),
  startBtn: document.getElementById('startBtn'),
  nameBtn: document.getElementById('nameBtn'),
  peekBtn: document.getElementById('peekBtn'),
  prevBottom: document.getElementById('prevBottom'),
  nextBottom: document.getElementById('nextBottom'),
  content: document.getElementById('content'),
  metaDay: document.getElementById('metaDay'),
  metaStep: document.getElementById('metaStep'),
  dotsWrap: document.getElementById('footerDots'),
  toast: document.getElementById('toast'),
  toastMsg: document.getElementById('toastMsg'),
  nameMenu: document.getElementById('nameMenu')
};

// [NOWE] â€” intro:false w stanie
let state = {
  name: '',
  day: 1,
  step: 0,
  done: Array(9).fill(false),
  start_date: null,
  preview: false,
  rosary: null,
  lastRosaryType: null,
  fromRosaryExit: false,
  intro: false
};
let snapshot = null;

function keyFor(name){ return LS_PREFIX + name.toLowerCase().trim(); }
function save(){
  if(!state.name) return;
  if(state.preview) return;
  if(TESTING) return;
  localStorage.setItem(keyFor(state.name), JSON.stringify({
    display_name: state.name,
    day:state.day,
    step:state.step,
    done:state.done,
    start_date: state.start_date
    // intro celowo nie zapisujemy
  }));
}
function clearFor(name){ localStorage.removeItem(keyFor(name)); }
function load(name){
  const raw = localStorage.getItem(keyFor(name));
  if(!raw){ state = { ...state, name, day:1, step:0, done:Array(9).fill(false), start_date: todayISO(), preview:false, rosary:null, intro:false }; return; }
  try{
    const d = JSON.parse(raw);
    state = {
      ...state,
      name: d.display_name || name,
      day: d.day||1,
      step: d.step||0,
      done: Array.isArray(d.done)? d.done.slice(0,9).concat(Array(9).fill(false)).slice(0,9) : Array(9).fill(false),
      start_date: d.start_date || todayISO(),
      preview:false,
      rosary:null,
      intro:false
    };
  }catch(e){ state = { ...state, name, day:1, step:0, done:Array(9).fill(false), start_date: todayISO(), preview:false, rosary:null, intro:false }; }
}

// --- Daty ---
function pad(n){ return String(n).padStart(2,'0'); }
function toISODate(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }
function todayISO(){ const d = new Date(); return toISODate(new Date(d.getFullYear(), d.getMonth(), d.getDate())); }
function parseISODate(s){ const [y,m,da] = s.split('-').map(Number); return new Date(y, m-1, da); }
function formatPL(d){ return `${pad(d.getDate())}.${pad(d.getMonth()+1)}.${d.getFullYear()}`; }
function addDays(base, days){ const d = new Date(base.getTime()); d.setDate(d.getDate()+days); return d; }
function dateForDay(day){ if(!state.start_date) return null; const start = parseISODate(state.start_date); return addDays(start, day-1); }
function dayFromStart(){
  if(!state.start_date) return 1;
  const start = parseISODate(state.start_date);
  const today = parseISODate(todayISO());
  const diffMs = today - start;
  const days = Math.floor(diffMs / (24*60*60*1000));
  return Math.min(9, Math.max(1, days + 1));
}

function msUntilNextMidnight(){
  const now = new Date();
  const next = new Date(now.getFullYear(), now.getMonth(), now.getDate()+1, 0,0,0,0);
  return next - now;
}
function syncDayToCalendar(){
  if(!state.name || state.preview) return;
  const idx = dayFromStart();
  if(state.day !== idx){ state.day = idx; state.step = 0; render(); }
}
let midnightTimer = null;
function scheduleMidnightSync(){
  if(midnightTimer){ clearTimeout(midnightTimer); clearInterval(midnightTimer); midnightTimer = null; }
  midnightTimer = setTimeout(()=>{
    syncDayToCalendar();
    midnightTimer = setInterval(syncDayToCalendar, 24*60*60*1000);
  }, msUntilNextMidnight());
}

// --- UI helpers ---
function setTheme(mode){ const root = document.documentElement; if(mode === 'dark') root.classList.add('dark'); else root.classList.remove('dark'); localStorage.setItem(LS_THEME, mode); }
function toggleTheme(){ const isDark = document.documentElement.classList.contains('dark'); setTheme(isDark? 'light' : 'dark'); }
function initTheme(){ const saved = localStorage.getItem(LS_THEME); if(saved){ setTheme(saved); } else { const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches; setTheme(prefersDark? 'dark':'light'); } }

function updateStartButton(){
  if (isResetEligible()) {
    ui.startBtn.disabled = false;
    return;
  }
  ui.startBtn.disabled = !canStart();
}

function stepsForCurrent(){ return DAYS[state.day-1]; }

// â€” Czy sÄ… linki do rÃ³Å¼aÅ„ca w tym dniu
function hasRosaryForCurrentDay(){
  const steps = DAYS[state.day-1] || [];
  return steps.some(s => typeof s === 'string' && s.includes('data-rosary'));
}
function totalForDay(){
  const baseLen = (DAYS[state.day-1]||[]).length;
  return baseLen + (hasRosaryForCurrentDay() ? 9 : 0);
}
function rosaryLinkIndex(){
  const steps = DAYS[state.day-1] || [];
  for(let i=0;i<steps.length;i++){
    if(typeof steps[i]==='string' && steps[i].includes('data-rosary')) return i;
  }
  return -1;
}
function displayStepNumberForBaseStep(baseIdx){
  const linkIdx = rosaryLinkIndex();
  if(linkIdx === -1) return baseIdx + 1;
  if(baseIdx < linkIdx) return baseIdx + 1;
  if(baseIdx === linkIdx) return baseIdx + 1;
  return baseIdx + 1 + 9;
}

// â— WYMUSZAMY WYBÃ“R TAJEMNICY ZAWSZE â€” takÅ¼e w podglÄ…dzie
function isRosarySelectionStep(){
  const steps = stepsForCurrent();
  const cur = steps[state.step];
  return !state.rosary && typeof cur === 'string' && cur.includes('data-rosary');
}

function isResetEligible(){
  if(!state.name) return false;
  if(state.day!==9) return false;
  const steps = stepsForCurrent();
  return state.step === steps.length - 1;
}
function canStart(){
  const typed = ui.nameInput.value.trim();
  if(!typed) return false;
  if(state.name && typed.toLowerCase() === state.name.toLowerCase()) return false;
  return true;
}

// --- RÃ³Å¼aniec ---
function startRosary(type){
  state.lastRosaryType = type;
  state.rosary = { type, phase:'first3', index:0 };
  render();
}
function rosaryCurrentHTML(){
  const R = state.rosary;
  const pack = MYSTERIES[R.type];

  if(R.phase==='first3'){
    const cur = pack.first3[R.index];
    return `
      <h3>${pack.name} â€” dziesiÄ…tek ${R.index+1}/3</h3>
      <p><strong>${cur.t}</strong><br/>${cur.m}</p>
      <p class='hint'>OdmÃ³w: Ojcze nasz â€¢ 10Ã— ZdrowaÅ› Maryjo â€¢ ChwaÅ‚a Ojcu.</p>
    `;
  }
  if(R.phase==='dailyPrayer'){
    return DAILY_PRAYERS_BY_DAY[String(state.day)] || DAILY_PRAYERS_BY_DAY[state.day] || '<h3>Modlitwa dnia</h3><p>Panie, prowadÅº mnie dziÅ› i umacniaj w miÅ‚oÅ›ci. Amen.</p>';
  }
  if(R.phase==='last2'){
    const cur = pack.last2[R.index];
    return `
      <h3>${pack.name} â€” dziesiÄ…tek ${R.index+1}/2 (koÅ„cowe)</h3>
      <p><strong>${cur.t}</strong><br/>${cur.m}</p>
      <p class='hint'>OdmÃ³w: Ojcze nasz â€¢ 10Ã— ZdrowaÅ› Maryjo â€¢ ChwaÅ‚a Ojcu.</p>
    `;
  }
  if(R.phase==='litania'){ return LITANIA_LORETANSKA; }
  if(R.phase==='bernard'){ return MODL_SW_BERNARDA; }
  if(R.phase==='closing'){ return CLOSING_PRAYER; }
  return '';
}
function rosaryStageLabel(){
  if(!state.rosary) return '';
  const R = state.rosary; const pack = MYSTERIES[R.type];
  switch(R.phase){
    case 'first3': return `${pack.name} â€” dziesiÄ…tek ${R.index+1}/3`;
    case 'dailyPrayer': return `Modlitwa dnia (${pack.name})`;
    case 'last2': return `${pack.name} â€” dziesiÄ…tek ${R.index+1}/2 (koÅ„cowe)`;
    case 'litania': return 'Litania LoretaÅ„ska';
    case 'bernard': return 'Modlitwa Å›w. Bernarda';
    case 'closing': return 'Modlitwa na zakoÅ„czenie';
    default: return '';
  }
}
function bindRosaryLinks(){
  const links = ui.content.querySelectorAll('a[data-rosary]');
  links.forEach(a=>{
    a.addEventListener('click', (e)=>{
      e.preventDefault();
      const t = a.getAttribute('data-rosary');
      if(!t) return;
      startRosary(t);
    });
  });
}

// --- Render ---
function render(){
  updateStartButton();

  if(!state.name){
    ui.content.innerHTML = 'Podaj imiÄ™ i kliknij â€Startâ€, aby zaczÄ…Ä‡ dzieÅ„ 1. Albo kliknij w ikonkÄ™ postaci, by wybraÄ‡ wczeÅ›niej zapisanych uÅ¼ytkownikÃ³w.';
    ui.metaDay.textContent = 'DzieÅ„ â€“';
    ui.metaStep.textContent = 'Krok â€“/â€“';
  } else {
    if(state.intro){
      // [NOWE] â€” ekran opisu
      ui.content.innerHTML = INTRO_HTML;
      const d = dateForDay(state.day);
      const dateStr = d ? formatPL(d) : 'â€”';
      ui.metaDay.textContent = `DzieÅ„ ${state.day} z 9 â€” ${dateStr}`;
      ui.metaStep.textContent = `Opis`;
    } else if(state.rosary){
      ui.content.innerHTML = rosaryCurrentHTML();
      const d = dateForDay(state.day);
      const dateStr = d ? formatPL(d) : 'â€”';
      ui.metaDay.textContent = `DzieÅ„ ${state.day} z 9 â€” ${dateStr}`;
      ui.metaStep.textContent = `Krok â€¦ z ${totalForDay()}`;
    } else {
      const steps = stepsForCurrent();
      const safeStep = Math.max(0, Math.min(state.step, steps.length-1));
      state.step = safeStep;
      ui.content.innerHTML = steps[safeStep];
      const d = dateForDay(state.day);
      const dateStr = d ? formatPL(d) : 'â€”';
      ui.metaDay.textContent = `DzieÅ„ ${state.day} z 9 â€” ${dateStr}`;
      ui.metaStep.textContent = `Krok ${displayStepNumberForBaseStep(safeStep)} z ${totalForDay()}`;
    }
  }

  // Dots
  if (!ui.dotsWrap) {
    console.warn('Brak kontenera #footerDots â€” pomijam render kropek.');
  } else {
    ui.dotsWrap.innerHTML = '';
    for (let i = 1; i <= 9; i++) {
      const dot = document.createElement('div');
      dot.className = 'dot';
      if (state.name || state.preview) {
        const isDone =
          !!(state.done[i - 1]) ||
          i < state.day ||
          (i === state.day && (state.step > 0 || !!state.rosary || state.intro));
        if (isDone) dot.classList.add('done');
        if (i === state.day) dot.classList.add('current');
      }
      const dt = state.name ? dateForDay(i) : null;
      dot.title = state.name && dt ? `DzieÅ„ ${i} â€” ${formatPL(dt)}` : `DzieÅ„ ${i}`;
      ui.dotsWrap.appendChild(dot);
    }
  }

  // Nawigacja
  const canNavigate = state.name || state.preview;
  const stepsArr = canNavigate ? stepsForCurrent() : null;
  const atFirst = !stepsArr || state.step===0;
  const atLast  = !stepsArr || state.step===stepsArr.length-1;
  const disablePrevBase = !canNavigate || (atFirst && !(state.preview && state.day>1));
  let disablePrev = disablePrevBase;
  let disableNext = !canNavigate || (atLast  && !(state.preview && state.day<9));

  // blokada â€Dalejâ€ na ekranie linkÃ³w rÃ³Å¼aÅ„ca
  if(isRosarySelectionStep()) disableNext = true;

  // Ekrany koÅ„cowe â€” Next aktywny
  if (
    state.name && stepsArr && (
      stepsArr[state.step] === ZAKONCZ_DZIEN_INFO ||
      stepsArr[state.step] === ZAKONCZ_DZIEN_GENERIC ||
      stepsArr[state.step] === ZAKONCZ_DZIEN_FINAL
    )
  ){
    disableNext = false;
  }

  // [NOWE] â€” na kroku 1 pokaÅ¼ â€âŸµ Opisâ€ i wÅ‚Ä…cz Wstecz
  if (!state.preview && state.name && !state.intro && state.step === 0) {
    disablePrev = false;
    ui.prevBottom.textContent = 'âŸµ Opis';
  } else {
    ui.prevBottom.textContent = 'âŸµ Wstecz';
  }

  // W trybie opisu â€” â€Dalejâ€ zawsze dostÄ™pny (wychodzi do kroku 1)
  if (state.intro) {
    disableNext = false;
  }

  ui.prevBottom.disabled = disablePrev;
  ui.nextBottom.disabled = disableNext;

  // Start/Reset
  ui.startBtn.textContent = isResetEligible() ? 'Reset' : 'Start';

  // Linki rÃ³Å¼aÅ„ca â€” podpinaj w normalnym trybie i w podglÄ…dzie (ale nie w opisie)
  if(!state.rosary && (state.name || state.preview) && !state.intro){
    const s = stepsForCurrent();
    if(s[state.step] && s[state.step].includes('data-rosary')) bindRosaryLinks();
  }

  // Pasek informacyjny o podglÄ…dzie
  const previewBar = document.getElementById('previewInfo');
  if (previewBar) previewBar.style.display = state.preview ? 'block' : 'none';
}

// â€” Reset wewnÄ™trzny (bez przeÅ‚adowania strony)
function resetAll(){
  if(state.name){
    state.done[state.day-1] = true;
    save();
  }
  state = { name:'', day:1, step:0, done:Array(9).fill(false), start_date:null, preview:false, rosary:null, lastRosaryType:null, fromRosaryExit:false, intro:false };
  snapshot = null;
  ui.nameInput.value = '';
  if(ui.peekBtn) ui.peekBtn.classList.remove('active');
  render();
}

// Minimalny toast (tylko powitanie)
function showToast(msg){
  ui.toastMsg.textContent = msg;
  ui.toast.classList.add('show');
  setTimeout(()=> ui.toast.classList.remove('show'), 3600);
}

// --- Nawigacja ---
function nextStep(){
  // [NOWE] â€” z OPISU wchodzimy do kroku 1
  if (state.intro) {
    state.intro = false;
    state.step = 0;
    render();
    return;
  }

  // RÃ³Å¼aniec â€” wewnÄ™trzna Å›cieÅ¼ka
  if(state.rosary){
    const R = state.rosary;
    if(R.phase==='first3'){
      if(R.index<2){ R.index++; render(); return; }
      R.phase='dailyPrayer'; render(); return;
    }
    if(R.phase==='dailyPrayer'){
      R.phase='last2'; R.index=0; render(); return;
    }
    if(R.phase==='last2'){
      if(R.index<1){ R.index++; render(); return; }
      R.phase='litania'; render(); return;
    }
    if(R.phase==='litania'){ R.phase='bernard'; render(); return; }
    if(R.phase==='bernard'){ R.phase='closing'; render(); return; }
    if(R.phase==='closing'){
      state.rosary = null;
      const steps = stepsForCurrent();
      if(state.step < steps.length-1){
        state.step += 1;
        state.fromRosaryExit = true;
        save(); render();
      } else {
        state.done[state.day-1] = true; save(); render();
      }
      return;
    }
  }

  const steps = stepsForCurrent();

  // Ekran koÅ„cowy Dnia 1 -> reset (poza podglÄ…dem)
  if(!state.preview && state.name && state.day === 1 && steps[state.step] === ZAKONCZ_DZIEN_INFO){
    resetAll();
    return;
  }
  // Ekran koÅ„cowy Dni 2â€“9 -> reset (poza podglÄ…dem)
  if(!state.preview && state.name && steps[state.step] === ZAKONCZ_DZIEN_GENERIC){
    resetAll();
    return;
  }

  // PodglÄ…d
  if(state.preview){
    if(state.step < steps.length-1){ state.step += 1; render(); return; }
    if(state.day < 9){ state.day += 1; state.step = 0; render(); return; }
    // PodglÄ…d i koniec Dnia 9 -> reset do startu
    resetAll();
    return;
  }

  if(!state.name) return;

  // ZwykÅ‚e przejÅ›cie
  if(state.step < steps.length-1){
    state.step += 1;
    state.fromRosaryExit = false;
    save(); render(); return;
  }

  // Koniec dnia (2â€“9)
  state.done[state.day-1] = true; save();
  if(state.day===9){
    render();
  } else {
    state.step = 0; render();
  }
}

function prevStep(){
  // [NOWE] â€” na kroku 1 â€Wsteczâ€ otwiera OPIS
  if (state.name && !state.preview && !state.intro && state.step === 0) {
    state.intro = true;
    render();
    return;
  }
  // [NOWE] â€” bÄ™dÄ…c w OPISIE â€Wsteczâ€ wraca do kroku 1
  if (state.intro) {
    state.intro = false;
    state.step = 0;
    render();
    return;
  }

  if(state.rosary){
    const R = state.rosary;
    if(R.phase==='first3'){
      if(R.index>0){ R.index--; render(); return; }
      state.rosary = null;
      state.step = rosaryLinkIndex();
      render(); return;
    }
    if(R.phase==='dailyPrayer'){ R.phase='first3'; R.index=2; render(); return; }
    if(R.phase==='last2'){
      if(R.index>0){ R.index--; render(); return; }
      R.phase='dailyPrayer'; render(); return;
    }
    if(R.phase==='litania'){ R.phase='last2'; R.index=1; render(); return; }
    if(R.phase==='bernard'){ R.phase='litania'; render(); return; }
    if(R.phase==='closing'){ R.phase='bernard'; render(); return; }
    return;
  }
  if(!state.name && !state.preview) return;

  const linkIdx = rosaryLinkIndex();
  if (linkIdx !== -1 && state.step === linkIdx + 1 && state.lastRosaryType) {
    state.rosary = { type: state.lastRosaryType, phase:'closing', index:0 };
    render();
    return;
  }

  if(state.step > 0){ state.step -= 1; state.fromRosaryExit = false; save(); render(); }
}

// â€”â€”â€” ZDARZENIA â€”â€”â€”
ui.themeBtn.addEventListener('click', toggleTheme);
ui.startBtn.addEventListener('click', ()=>{
  if(isResetEligible()){
    const prevName = state.name; if(prevName) clearFor(prevName);
    state.preview = false; if(ui.peekBtn) ui.peekBtn.classList.remove('active');
    state = { name:'', day:1, step:0, done:Array(9).fill(false), start_date:null, preview:false, rosary:null, lastRosaryType:null, fromRosaryExit:false, intro:false };
    snapshot = null; ui.nameInput.value = '';
    render();
    return;
  }
  const inputName = ui.nameInput.value.trim();
  if(!inputName){ return; }
  state.preview = false; snapshot = null; ui.peekBtn.classList.remove('active');
  state.intro = false; // zawsze start z kroku 1
  load(inputName); if(!state.start_date) state.start_date = todayISO(); save(); render(); showToast(`Witaj, ${state.name}!`);
  ui.nameInput.value = state.name; updateStartButton();
  scheduleMidnightSync(); syncDayToCalendar();
});

ui.prevBottom.addEventListener('click', prevStep);
ui.nextBottom.addEventListener('click', nextStep);
ui.nameInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter' && canStart()) ui.startBtn.click(); });
ui.nameInput.addEventListener('input', updateStartButton);

ui.peekBtn.addEventListener('click', ()=>{
  if(state.preview){
    if(snapshot){ state = JSON.parse(snapshot); snapshot = null; }
    state.preview = false; state.intro = false;
    ui.peekBtn.classList.remove('active');
    render();
  } else {
    snapshot = JSON.stringify(state);
    state.preview = true; state.intro = false;
    ui.peekBtn.classList.add('active');
    if(!state.day) state.day = 1; if(!state.step) state.step = 0;
    render();
  }
});

function listProfiles(){
  const rows = [];
  for(let i=0;i<localStorage.length;i++){
    const k = localStorage.key(i);
    if(!k || !k.startsWith(LS_PREFIX)) continue;
    try{
      const d = JSON.parse(localStorage.getItem(k) || '{}');
      const name = d.display_name || k.slice(LS_PREFIX.length);
      if(!name || /^\s*$/.test(name)) continue;
      const start = d.start_date ? formatPL(parseISODate(d.start_date)) : 'â€”';
      const doneCount = Array.isArray(d.done) ? d.done.filter(Boolean).length : 0;
      rows.push({name, start, doneCount});
    }catch(_){ /* ignore */ }
  }
  rows.sort((a,b)=> a.name.localeCompare(b.name, 'pl'));
  return rows;
}
function openNameMenu(){
  const rows = listProfiles();
  const menu = ui.nameMenu; if(!menu) return;
  if(rows.length===0){
    menu.innerHTML = '<div class="empty">Brak zapisanych imion. Zacznij od wpisania imienia i kliknij â€Startâ€.</div>';
  } else {
    const items = rows.map(r => `
      <div class="item" data-name="${r.name}">
        <div>
          <div><strong>${r.name}</strong></div>
          <div class="meta">start: ${r.start} â€¢ ukoÅ„czone dni: ${r.doneCount}/9</div>
        </div>
        <button class="del" data-del="${r.name}">UsuÅ„</button>
      </div>`).join('');
    menu.innerHTML = '<h4>Zapisane imiona</h4>' + items;
  }
  menu.classList.add('show');
  menu.setAttribute('aria-hidden','false');
}
function closeNameMenu(){ if(!ui.nameMenu) return; ui.nameMenu.classList.remove('show'); ui.nameMenu.setAttribute('aria-hidden','true'); }

ui.nameBtn.addEventListener('click', (e)=>{
  e.stopPropagation();
  if(ui.nameMenu.classList.contains('show')) closeNameMenu(); else openNameMenu();
});

document.addEventListener('click', (e)=>{
  if(!ui.nameMenu.classList.contains('show')) return;
  if(!ui.nameMenu.contains(e.target) && e.target !== ui.nameBtn) closeNameMenu();
});

ui.nameMenu.addEventListener('click', (e)=>{
  const del = e.target.closest('[data-del]');
  if(del){
    const n = del.getAttribute('data-del');
    if(n){
      clearFor(n);
      if(state.name && state.name.toLowerCase()===n.toLowerCase()){
        state = { name:'', day:1, step:0, done:Array(9).fill(false), start_date:null, preview:false, rosary:null, lastRosaryType:null, fromRosaryExit:false, intro:false };
        render();
      }
      openNameMenu();
    }
    return;
  }
  const item = e.target.closest('.item');
  if(item){
    const n = item.getAttribute('data-name');
    if(n){
      state.preview=false; if(ui.peekBtn) ui.peekBtn.classList.remove('active');
      state.intro=false;
      load(n); if(!state.start_date) state.start_date = todayISO(); save(); render(); showToast(`Witaj, ${state.name}!`); closeNameMenu();
      ui.nameInput.value = state.name; updateStartButton();
      scheduleMidnightSync(); syncDayToCalendar();
    }
  }
});

// Override numeracji w trakcie rÃ³Å¼aÅ„ca â€” ciÄ…gÅ‚a numeracja Krok X z Y
try{
  const __renderOriginal = render;
  render = function(){
    __renderOriginal();
    if(state && state.rosary){
      const baseIdx = rosaryLinkIndex();
      const R = state.rosary; let ord = 1;
      if(R.phase==='first3'){ ord = R.index + 1; }
      else if(R.phase==='dailyPrayer'){ ord = 4; }
      else if(R.phase==='last2'){ ord = 5 + R.index; }
      else if(R.phase==='litania'){ ord = 7; }
      else if(R.phase==='bernard'){ ord = 8; }
      else if(R.phase==='closing'){ ord = 9; }
      const total = totalForDay();
      if(ui && ui.metaStep){ ui.metaStep.textContent = `Krok ${baseIdx + ord + 1} z ${total}`; }
    }
  };
}catch(e){ /* ignore */ }

// â€”â€”â€” PROSTE TESTY â€”â€”â€”
(function selfTests(){
  const backupState = JSON.stringify(state);
  const backupNameInput = ui.nameInput.value;
  const backupPeekActive = ui.peekBtn.classList.contains('active');
  TESTING = true;
  try{
    console.assert(typeof totalForDay()==='number', 'totalForDay number');

    // SprawdÅº, Å¼e w PODGLÄ„DZIE teÅ¼ blokujemy "Dalej" na ekranie linkÃ³w
    state.name = 'Test'; state.preview = true; state.day = 1; state.step = rosaryLinkIndex() >=0 ? rosaryLinkIndex() : 1; state.rosary=null; state.intro=false;
    render();
    console.assert(isRosarySelectionStep() === true, 'Preview: isRosarySelectionStep should be true');
    console.assert(ui.nextBottom.disabled === true, 'Preview: Next must be disabled on rosary selection');

    // Test etykiety â€Opisâ€
    state.preview = false; state.step = 0; state.intro=false; render();
    console.assert(ui.prevBottom.textContent.includes('Opis'), 'Prev label should be Opis on step 0');

    console.log('%cAll self-tests passed','color:green');
  }catch(err){ console.warn('Self-tests failed:', err); }
  try{ state = JSON.parse(backupState); }catch(_){
    state = { name:'', day:1, step:0, done:Array(9).fill(false), start_date:null, preview:false, rosary:null, lastRosaryType:null, fromRosaryExit:false, intro:false };
  }
  ui.nameInput.value = backupNameInput || '';
  if(backupPeekActive) ui.peekBtn.classList.add('active'); else ui.peekBtn.classList.remove('active');
  TESTING = false;
  state.name = '';
  state.preview = false;
  state.rosary = null;
  state.lastRosaryType = null;
  state.intro = false;
  render();
})();

(function init(){
  initTheme();
  render();
  scheduleMidnightSync();
  document.addEventListener('visibilitychange', ()=>{ if(document.visibilityState==='visible') syncDayToCalendar(); });
})();
</script>
</body>
</html>
